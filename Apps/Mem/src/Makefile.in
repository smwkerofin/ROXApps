PKG_CONFIG = "@PKG_CONFIG@"
SHELL = @SHELL@
srcdir = "@srcdir@"
PLATFORM = @with_platform@
PLATFORM_DIR = ../${PLATFORM}
.SUFFIXES:
.SUFFIXES: .c .o
ROX_CLIB = "@ROX_CLIB_PATH@/AppRun"
LIBS = @LIBS@ @LIBGTOP_LIBS@
EXTRA_PACKAGES=@EXTRA_PACKAGES@

CC = @CC@
CFLAGS = @CFLAGS@ @LIBGTOP_CFLAGS@ -I. `${ROX_CLIB} --cflags`
LDFLAGS = @LDFLAGS@ `${ROX_CLIB} --libs`  ${LIBS}
EXEC = ${PLATFORM_DIR}/${PROG}

############ Things to change for different programs

PROG = Mem

SRCS = mem.c mem_stats.c

OBJECTS = mem.o mem_stats.o

############ Things to keep the same

${EXEC}: ${PROG}
	[ -d "${PLATFORM_DIR}" ] || mkdir "${PLATFORM_DIR}"
	mv "${PROG}" "${EXEC}"

${PROG}: ${OBJECTS}
	${CC} -o ${PROG} ${OBJECTS} ${LDFLAGS}

${PLATFORM_DIR}:
	mkdir "${PLATFORM_DIR}"

messages.pot: $(SRCS)
	xgettext --keyword=_ --keyword=N_ --output=messages.pot $(SRCS)

clean:
	rm -f *.o Makefile.bak

zero-install: clean
	strip "${EXEC}"

depend:
	makedepend -- $(CFLAGS) -- $(SRCS)

Makefile: Makefile.in config.status
	./config.status

config.h: config.h.in
	./config.status

config.status: configure
	APP_DIR="${srcdir}/.." ./configure --with-platform=${PLATFORM}

configure: configure.in
	autoconf
